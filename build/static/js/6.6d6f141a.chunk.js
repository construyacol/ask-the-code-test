(this["webpackJsonpcoinsenda-app"]=this["webpackJsonpcoinsenda-app"]||[]).push([[6,9,18,19,21,59],{365:function(e,t,n){"use strict";n.r(t);var a,i,o=n(327),c=n(2),r=n(328),s=n(344),l=n(376),d=n(14);const u=Object(r.c)(a||(a=Object(o.a)(["\n    0% {\n        opacity: 1;\n        transform: scale(1);\n    }\n    30% {\n        transform: scale(0);\n        opacity: 0;\n    }\n    50%{\n        transform: scale(0);\n        opacity: 0;\n    }\n    80%{\n        opacity: 1;\n        transform: scale(1.3);\n    }\n    100%{\n        opacity: 1;\n        transform: scale(0.9);\n        background:#2ad083;\n        border: 4px solid white;\n    }\n    "]))),v=r.b.div(i||(i=Object(o.a)(["\n      width: 60px;\n      height: 60px;\n      position: absolute;\n      border-radius: 50%;\n      background: white;\n      border: 2px solid #cfcfcf;\n      top:175px;\n      right:200px;\n      z-index: 1;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      &.approve{\n         animation: "," .6s linear forwards;\n      }\n\n     \n\n    @media (max-width: 768px) {\n      top: 380px;\n      right: 0;\n      left: 50px;\n    }\n  "])),u);t.default=e=>{let{data:t}=e;const[n,a]=Object(c.useState)();return Object(c.useEffect)((()=>{t?a("approve"):setTimeout((()=>a()),400)}),[t]),Object(d.jsx)(v,{className:"".concat("approve"===n?"approve":"normal"),children:n?Object(d.jsx)(l.e,{size:37,color:"white"}):Object(d.jsx)(s.d,{size:30,color:"#a3a3a3"})})}},373:function(e,t,n){"use strict";n.r(t);var a=n(327),i=n(2),o=n(355),c=n(402);var r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const a=Object(o.f)(),[r,s]=Object(i.useState)(),[l,d]=Object(i.useState)(n),[u,v]=Object(i.useState)(t[e[l]]),p=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;l>=e.length||d((e=>e+t))},g=()=>{l<=0||d((e=>e-1))};return Object(i.useEffect)((()=>{var e;if(null===u||void 0===u||null===(e=u.settings)||void 0===e?void 0:e.queryParams){let e=Object(c.b)(u.settings.queryParams);a.push(e)}}),[u]),Object(i.useEffect)((()=>{const n=t[e[l]];v(n)}),[l,t[e[l]]]),{currentStage:l,nextStage:p,prevStage:g,stageController:e,stageData:u,setStageData:v,stageStatus:r,setStageStatus:s,finalStage:l>=e.length}},s=n(385);const l=(e,t)=>{var n,a;let i;return console.log("|||||| detections smile",null===e||void 0===e||null===(n=e.expressions)||void 0===n?void 0:n.happy),(null===e||void 0===e||null===(a=e.expressions)||void 0===a?void 0:a.happy)>.97&&(i=Object(s.getFrame)()),[i]},d=(e,t)=>{var n,a;let i;return console.log("|||||| detections surprised",null===e||void 0===e||null===(n=e.expressions)||void 0===n?void 0:n.surprised),(null===e||void 0===e||null===(a=e.expressions)||void 0===a?void 0:a.surprised)>.5&&(i=Object(s.getFrame)()),[i]};var u=()=>({smile:l,surprised:d}),v=n(53),p=n(328),g=n(365),b=n(396),f=n(394),m=n(15),h=n(424),j=n(333),x=n(488),O=n.n(x),w=n(28);var y,S,k,F,D,z=n(98),N=(n(429),n(14));const U="/models",E=Object(v.a)((()=>Promise.resolve().then(n.bind(null,453))));t.default=e=>{var t,n,a,o;let{handleDataForm:c,handleState:l}=e;const d=Object(z.d)((e=>e.modelData)),{dataForm:v}=c,{state:p,setState:x}=l,[y,S]=Object(i.useState)(!1),[k,F]=Object(i.useState)(),[D,M]=Object(i.useState)(!1),[T]=Object(j.a)(),I=u(),_=Object(i.useRef)(null);let B=Object(i.useRef)(null);const G=Object(i.useRef)(window.faceapi),[P]=Object(i.useState)(null===(t=window)||void 0===t||null===(n=t.location)||void 0===n||null===(a=n.search)||void 0===a?void 0:a.includes("developer=true")),[V]=function(e,t){const{SocketUrl:n}=m.a,a=O()(n),[o,c]=Object(i.useState)(),r=async()=>{const{userToken:e}=await Object(w.c)(),t={body:{access_token:e}};a.emit("authentication",t)};return Object(i.useEffect)((()=>{a.on("connect",r),a.on("authenticated",(()=>{a.on(e,(e=>{c((t=>({...t,...e})))}))}))}),[]),[o]}("/biometric_data/".concat(d.user.id)),J=r(Object.keys((null===v||void 0===v||null===(o=v.handleError)||void 0===o?void 0:o.errors)||v.stages),v.stages),{stageData:H,currentStage:W,nextStage:K,finalStage:Q,setStageData:X,stageController:Y}=J,Z=async()=>{if(S(!0),!window.faceapi)return alert("No est\xe1n cargando las librer\xedas");G.current=window.faceapi,await G.current.nets.tinyFaceDetector.loadFromUri(U),await G.current.nets.faceLandmark68Net.loadFromUri(U),await G.current.nets.faceRecognitionNet.loadFromUri(U),await G.current.nets.faceExpressionNet.loadFromUri(U),te()},$=e=>{F(!0),_.current&&(_.current.srcObject=e)},ee=e=>{console.log("No hay camara conectada o los permisos han sido denegados",e),F(!1)},te=()=>{if(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,navigator.getUserMedia){var e;if(navigator.getUserMedia({video:!0},$,ee),!(null===(e=_.current)||void 0===e?void 0:e.addEventListener))return;_.current.addEventListener("play",(()=>{console.log("el streaming a comenzado",G.current);const e=G.current.createCanvasFromMedia(_.current);e.style.display="none",e.id="faceApiCanvas",document.querySelector("#videoContainer").append(e),G.current.matchDimensions(e,Object(s.getDisplaySize)()),S(!1)}))}},ne=(e,t)=>{const n=document.querySelector(".FRecScanner");let a=1;B.current=setInterval((async()=>{const t=await G.current.detectAllFaces(_.current,new G.current.TinyFaceDetectorOptions).withFaceLandmarks().withFaceDescriptors().withFaceExpressions();if(P&&((e,t)=>{e.style.display="initial";const n=G.current.resizeResults(t,Object(s.getDisplaySize)());e.getContext("2d").clearRect(0,0,e.width,e.height),G.current.draw.drawFaceLandmarks(e,n),G.current.draw.drawDetections(e,n),G.current.draw.drawFaceExpressions(e,n)})(e,t),null===t||void 0===t?void 0:t.length){var i,o;if(console.log("validations",null===H||void 0===H?void 0:H.key),n&&!(null===n||void 0===n||null===(i=n.classList)||void 0===i||null===(o=i.value)||void 0===o?void 0:o.includes("scanning"))&&n.classList.add("scanning"),!I[null===H||void 0===H?void 0:H.key])return;const[c]=I[H.key](t[0],{...H,state:p,dataForm:v});if(!c||a>1)return;e.style.display="none",x((e=>({...e,[null===H||void 0===H?void 0:H.key]:c||e[null===H||void 0===H?void 0:H.key]}))),clearInterval(B.current),a++;const r=await T.addNewBiometricData({file:c.split(",")[1],biometric_id:H.biometricId,challenge_name:H.key});!1===(null===r||void 0===r?void 0:r.data)&&ae(),console.log("|||||||||||||||  addNewBiometricData res ==> ",r)}else{var c;console.log("Detectando..."),n&&(null===n||void 0===n||null===(c=n.classList)||void 0===c?void 0:c.value.includes("scanning"))&&n.classList.remove("scanning")}}),t)};Object(i.useEffect)((()=>{const e=document.querySelector("#faceApiCanvas");return D&&e&&!(null===H||void 0===H?void 0:H.solved)&&!Q&&ne(e,600),()=>clearInterval(B.current)}),[H,D,y]);const ae=()=>{X((e=>({...e,solved:!0}))),setTimeout((()=>K()),1500)};var ie;return Object(i.useEffect)((()=>{if(console.log("|||||||||||||  biometricData ==> ",V),"accepted"!==(null===V||void 0===V?void 0:V.state)||k||(console.log("cameraAvailable",k),(async()=>{const e=await T.getUserBiometric();(null===e||void 0===e?void 0:e.solved)&&K(Y.length+1)})()),(null===V||void 0===V?void 0:V.challenge_name)===(null===H||void 0===H?void 0:H.key))if("accepted"===V.state)ae();else if("rejected"===V.state){x((e=>({...e,[null===H||void 0===H?void 0:H.key]:""})));const e=document.querySelector("#faceApiCanvas");ne(e,600)}}),[V]),Object(i.useEffect)((()=>{if(Q){(async()=>await T.disableTransactionSecutiry("biometric"))()}}),[Q]),Object(i.useEffect)((()=>(Object(h.a)(Z,"".concat(Object(m.b)("faceApi")),"faceApi"),()=>{var e,t,n;null===(e=_.current)||void 0===e||e.pause(),null===(t=_.current)||void 0===t||null===(n=t.srcObject)||void 0===n||n.getTracks()[0].stop()})),[]),Q?Object(N.jsxs)(N.Fragment,{children:[P&&Object(N.jsx)(f.default,{state:p}),Object(N.jsx)(E,{component:null===v||void 0===v||null===(ie=v.successStage)||void 0===ie?void 0:ie.component,handleDataForm:c,handleState:l})]}):Object(N.jsxs)(C,{children:[!D&&Object(N.jsx)(E,{component:"onBoardingAgreement",cameraAvailable:k,handleAction:()=>{M(!0)}}),P&&Object(N.jsx)(f.default,{state:p}),Object(N.jsxs)(q,{id:"faceApiContainer",children:[Object(N.jsx)(g.default,{data:null===H||void 0===H?void 0:H.solved}),Object(N.jsx)("h3",{className:"FRecTitle fuente",children:"Reconocimiento Facial"}),Object(N.jsxs)(L,{id:"videoContainer",children:[y&&Object(N.jsx)("div",{className:"biometricLoaderContainer"}),!P&&Object(N.jsx)(b.Scanner,{className:"FRecScanner"}),Object(N.jsx)("video",{id:"streamingVideo",autoPlay:!0,ref:_,width:"100%",height:"100%"})]}),Object(N.jsxs)(R,{children:[Object(N.jsx)(A,{className:"".concat(0===W?"active":"")}),Object(N.jsx)(A,{className:"".concat(1===W?"active":"")})]}),Object(N.jsx)("h1",{className:"fuente",children:null===H||void 0===H?void 0:H.uiName}),Object(N.jsx)("p",{className:"fuente",children:"Mant\xe9n tu cabeza erguida y asegurate que tu rostro encaje dentro del circulo"})]})]})};const C=p.b.div(y||(y=Object(a.a)(["\n    display: grid;\n    width: 100vw;\n    height: 100vh;\n    background: #fffffffa;\n    position: absolute;\n    justify-items: center;\n    top: 0;\n    left: 0;\n"]))),A=p.b.div(S||(S=Object(a.a)(["\n  width:7px;\n  height:12px;\n  background:#c9c9c9;\n  border-radius:5px;\n  margin:0 4px;\n  transition:.3s;\n  &.active{\n    height:22px;\n    background:#0198ff;\n  }\n"]))),R=p.b.div(k||(k=Object(a.a)(["\n  height:30px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"]))),L=p.b.div(F||(F=Object(a.a)(["\n  position: relative;\n  clip-path: circle(37% at 50% 50%);\n"]))),q=p.b.div(D||(D=Object(a.a)(["\n\n  position:relative;\n  width:100vw;\n  height:auto;\n  max-width:800px;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: auto 1fr auto auto auto;\n  height: calc(100vh - 80px);\n  padding: 40px 0;\n\n  .FRecTitle{\n    color:#0198ff;\n    font-weight:bold;\n  }\n  p{\n    text-align:center;\n    color:gray;\n    font-size: 1.2em;\n    max-width: 500px;\n    justify-self: center;\n  }\n  h1{\n    text-align:center;\n    font-size: 2.7em;\n    margin-bottom:0;\n  }\n  h3{\n    span{\n      color: transparent;\n      border-radius: 50%;\n      background: #2ad083;\n      margin-right: 10px;\n      font-size:15px;\n    }\n  }\n  @media (max-width: 768px) {\n  ","{\n    clip-path: circle(29% at 50% 50%);\n  }\n\n  padding: 30px 20px;\n  width:calc(100vw - 40px);\n\n  p{\n    font-size:1em;\n  }\n  h1{\n    font-size:2em;\n  }\n\n}\n"])),L)},385:function(e,t,n){"use strict";n.r(t),n.d(t,"getDisplaySize",(function(){return a})),n.d(t,"getFrame",(function(){return i}));const a=()=>{const e=document.querySelector("#streamingVideo");return{width:e.clientWidth,height:e.clientHeight}},i=()=>{const{width:e,height:t}=a(),n=document.querySelector("#faceApiCanvas");n.width=e,n.height=t;const i=document.querySelector("#streamingVideo");return n.getContext("2d").drawImage(i,0,0,e,t),n.toDataURL("image/jpeg")}},394:function(e,t,n){"use strict";n.r(t);var a,i=n(327),o=n(328),c=n(14);t.default=e=>{let{state:t}=e;return Object(c.jsx)(r,{id:"captures",children:Object.keys(t).map(((e,n)=>Object(c.jsx)("img",{src:t[e],width:"100%",alt:""},n)))})};const r=o.b.div(a||(a=Object(i.a)(["\n    position: absolute;\n    width: 150px;\n    height: auto;\n    min-height: 120px;\n    z-index: 2;\n    background: #ededed;\n    bottom: 10px;\n    right: 10px;\n    border-radius: 6px;\n    border: 3px solid darkgrey;\n"])))},396:function(e,t,n){"use strict";n.r(t),n.d(t,"Scanner",(function(){return s}));var a,i,o=n(327),c=n(328);const r=Object(c.c)(a||(a=Object(o.a)(["\n    0% {\n        top:0%\n    }\n    15%{\n        top:30%\n    }\n    35%{\n        top:70%\n    }\n    50%{\n        top:100%\n    }\n    65%{\n        top:70%\n    }\n    85%{\n        top:30%\n    }\n    100%{\n        top:0%;\n    }\n"]))),s=c.b.div(i||(i=Object(o.a)(["\n    height: 3px;\n    width: 100%;\n    position: absolute;\n    top: 0%;\n    transition: .3s;\n    filter: blur(0.1em);\n    background: rgb(255 255 255 / 10%);;\n    animation: "," 1.2s linear infinite;\n    &.scanning{\n    background: #2ad083;\n    }\n"])),r)},429:function(e,t,n){},497:function(e,t){}}]);
//# sourceMappingURL=6.6d6f141a.chunk.js.map