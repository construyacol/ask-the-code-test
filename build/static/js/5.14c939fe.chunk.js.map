{"version":3,"sources":["components/forms/widgets/biometricStatus/index.js","components/forms/widgets/biometricKycComponent/utils.js","components/forms/widgets/biometricKycComponent/captures.js","components/forms/widgets/biometricKycComponent/scanner.js","components/forms/hooks/useStage.js","components/forms/hooks/useInputValidations.js","components/forms/widgets/biometricKycComponent/index.js"],"names":["approve","keyframes","StatusContainer","styled","div","StatusIndicator","data","status","setStatus","useState","useEffect","setTimeout","className","size","color","getDisplaySize","video","document","querySelector","width","clientWidth","height","clientHeight","getFrame","canvas","getContext","drawImage","toDataURL","Captures","state","Container","id","Object","keys","map","stateKey","key","src","alt","scanning","Scanner","useStage","stageController","stages","defaultStage","history","useHistory","stageStatus","setStageStatus","currentStage","setCurrentStage","stageData","setStageData","nextStage","length","prevState","prevStage","settings","queryParams","query","getQuery","push","nextStageData","finalStage","smile","detections","frame","console","log","expressions","happy","surprised","useValidations","modelsPath","getCdnPath","DynamicLoadComponent","loadable","BiometricKycComponent","handleDataForm","handleState","dataForm","setState","loading","setLoading","cameraAvailable","setCameraAvailable","boardingAgreement","setBoardingAgreement","validations","videoEl","useRef","intervalDetection","faceApi","developerMood","window","location","search","includes","stageManager","handleError","errors","setupFaceApi","async","faceapi","alert","current","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","faceExpressionNet","startStreaming","handleVideo","stream","srcObject","videoError","err","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","oGetUserMedia","addEventListener","createCanvasFromMedia","style","display","append","matchDimensions","initDetections","intervalTime","scanner","counter","setInterval","detectAllFaces","TinyFaceDetectorOptions","withFaceLandmarks","withFaceDescriptors","withFaceExpressions","resizedDetections","resizeResults","clearRect","draw","drawFaceLandmarks","drawDetections","drawFaceExpressions","startDeveloperMood","classList","value","add","_value","clearInterval","remove","_stageData","loadDynamicScript","pause","getTracks","stop","component","successStage","Layout","handleAction","ContentContainer","VideoContainer","autoPlay","ref","IndicatorStage","Indicator","uiName"],"mappings":"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","file":"static/js/5.14c939fe.chunk.js","sourcesContent":["import { useState, useEffect } from \"react\";\nimport styled, { keyframes } from 'styled-components'\nimport { AiOutlineScan } from 'react-icons/ai';\nimport { BsCheck } from 'react-icons/bs';\n\n\nconst StatusIndicator = ({ data }) => {\n\n    const [ status, setStatus ] = useState()\n  \n    useEffect(()=>{\n        // console.log('_______ ====================== StatusIndicator ==>', data)\n        if(data){\n          setStatus('approve')\n        }else{\n          setTimeout(()=>setStatus(), 400)\n        }\n    }, [data])\n    \n    return(\n      <StatusContainer className={`${status === 'approve' ? 'approve' : 'normal'}`}>\n        { !status ?\n          <AiOutlineScan size={30} color=\"#a3a3a3\"/>\n          :\n          <BsCheck size={37} color=\"white\" />\n        }\n      </StatusContainer>\n    )\n  \n  }\n\n\n  const approve = keyframes`\n    0% {\n        opacity: 1;\n        transform: scale(1);\n    }\n    30% {\n        transform: scale(0);\n        opacity: 0;\n    }\n    50%{\n        transform: scale(0);\n        opacity: 0;\n    }\n    80%{\n        opacity: 1;\n        transform: scale(1.3);\n    }\n    100%{\n        opacity: 1;\n        transform: scale(0.9);\n        background:#2ad083;\n        border: 4px solid white;\n    }\n    `;\n  \n  const StatusContainer = styled.div`\n      width: 60px;\n      height: 60px;\n      position: absolute;\n      border-radius: 50%;\n      background: white;\n      border: 2px solid #cfcfcf;\n      top:175px;\n      right:200px;\n      z-index: 1;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      &.approve{\n         animation: ${approve} .6s linear forwards;\n      }\n\n     \n\n    @media (max-width: 768px) {\n      top: 380px;\n      right: 0;\n      left: 50px;\n    }\n  `\n\n\n  \n  export default StatusIndicator","\nexport const getDisplaySize = () => {\n  const video = document.querySelector(\"#streamingVideo\")\n  return { width: video.clientWidth, height: video.clientHeight }\n}\n\n\nexport const getFrame = () => {\n  const { width, height } = getDisplaySize()\n  const canvas = document.querySelector(\"#faceApiCanvas\")\n  canvas.width = width\n  canvas.height = height\n  const video = document.querySelector(\"#streamingVideo\")\n  const ctx = canvas.getContext('2d')\n  ctx.drawImage(video, 0,0, width, height)\n  let dataURL = canvas.toDataURL('image/jpeg')\n  return dataURL\n}","import styled from \"styled-components\"\n\n\nconst Captures = ({ state }) => {\n\n\n    return(\n        <Container id=\"captures\">\n            {\n                Object.keys(state).map((stateKey, key) => {\n                    return (\n                        <img src={state[stateKey]} width={\"100%\"} key={key} alt=\"\"/>\n                    )\n                })\n            }\n        </Container>\n    )\n\n}\n\nexport default Captures\n\nconst Container = styled.div`\n    position: absolute;\n    width: 150px;\n    height: auto;\n    min-height: 120px;\n    z-index: 2;\n    background: #ededed;\n    bottom: 10px;\n    right: 10px;\n    border-radius: 6px;\n    border: 3px solid darkgrey;\n`","import styled, { keyframes } from 'styled-components'\n\n\nconst scanning = keyframes`\n    0% {\n        top:0%\n    }\n    15%{\n        top:30%\n    }\n    35%{\n        top:70%\n    }\n    50%{\n        top:100%\n    }\n    65%{\n        top:70%\n    }\n    85%{\n        top:30%\n    }\n    100%{\n        top:0%;\n    }\n`;\n\n\nexport const Scanner = styled.div`\n    height: 3px;\n    width: 100%;\n    position: absolute;\n    top: 0%;\n    transition: .3s;\n    filter: blur(0.1em);\n    background: rgb(255 255 255 / 10%);;\n    animation: ${scanning} 1.2s linear infinite;\n    &.scanning{\n    background: #2ad083;\n    }\n`","import { useState, useEffect } from 'react'\nimport { useHistory } from \"react-router-dom\";\nimport { getQuery } from '../utils'\n\nconst useStage = (stageController, stages, defaultStage = 0) => {\n\n  const history = useHistory()\n  const [ stageStatus, setStageStatus ] = useState()\n  const [ currentStage, setCurrentStage ] = useState(defaultStage)\n  const [ stageData, setStageData ] = useState(stages[stageController[currentStage]])\n\n  const nextStage = () => {\n    // add ref or className on Json file Source to management the DOM components, e.x buttons states...\n    if(currentStage >= stageController.length){return}\n      setCurrentStage(prevState => prevState+1)\n  }\n\n  const prevStage = () => {\n    if(currentStage <= 0){return}\n    setCurrentStage(prevState => prevState-1)\n  }\n\n// Set url query params\n  useEffect(()=>{\n    if(stageData?.settings?.queryParams){\n      let query = getQuery(stageData.settings.queryParams)\n      history.push(query)\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [stageData])\n\n  useEffect(()=>{\n    const nextStageData = stages[stageController[currentStage]] \n    setStageData(nextStageData)\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentStage, stages[stageController[currentStage]]])\n\n  return {\n    currentStage,\n    nextStage,\n    prevStage,\n    stageController,\n    stageData,\n    setStageData,\n    stageStatus,\n    setStageStatus,\n    finalStage:currentStage >= stageController.length\n  }\n\n}\n\nexport default useStage\n","\nimport {\n  getFrame\n} from '../widgets/biometricKycComponent/utils'\n\nconst smile = (detections, data) => {\n  let frame\n  console.log('|||||| detections smile' , detections?.expressions?.happy)\n  if(detections?.expressions?.happy > 0.97 && !data.state[data.key]){\n    frame = getFrame()\n  }\n  return [ frame ]\n}\n\nconst surprised = (detections, data) => {\n  let frame\n  console.log('|||||| detections surprised' , detections?.expressions?.surprised)\n  if(detections?.expressions?.surprised > 0.95 && !data.state[data.key]){\n    frame = getFrame()\n  }\n  return [ frame ]\n}\n\n// // Incline la cabeza hacia el hombro derecho\n// if(detections[0].angle.roll > 0.6 && !document.querySelector('.tiltHead.right').src){\n//   console.log('Incline la cabeza hacia la derecha => ', detections[0].angle.roll)\n//   emitFrame('.tiltHead.right')\n// }\n\n// // Incline la cabeza hacia la izquierda\n// if(detections[0].angle.roll < -0.5 && !document.querySelector('.tiltHead.left').src){\n//   console.log('Incline la cabeza hacia la derecha => ', detections[0].angle.roll)\n//   emitFrame('.tiltHead.left')\n// }\n\nconst useValidations = () => {\n  return {\n    smile,\n    surprised\n  }\n}\n\nexport default useValidations\n","import { useEffect, useRef, useState } from 'react'\nimport useStage from '../../hooks/useStage'\nimport useValidations from '../../hooks/useInputValidations'\nimport { getDisplaySize } from './utils'\nimport loadable from '@loadable/component'\nimport styled from 'styled-components'\nimport StatusIndicator from '../biometricStatus'\nimport { Scanner } from './scanner'\nimport Captures from './captures'\nimport { getCdnPath } from '../../../../environment'\nimport loadDynamicScript from '../../../../utils/loadDynamicScript'\nimport './styles.css'\n\n\n// const modelsPath = '/models'\nconst modelsPath = `${getCdnPath('tensor')}/`\nconst DynamicLoadComponent = loadable(() => import('../../dynamicLoadComponent'))\n\n\nconst BiometricKycComponent = ({ handleDataForm, handleState }) => {\n\n  const { dataForm } = handleDataForm\n  const { state, setState } = handleState\n  const [ loading, setLoading ] = useState(false)\n  const [ cameraAvailable, setCameraAvailable ] = useState()\n  const [ boardingAgreement, setBoardingAgreement ] = useState(false)\n  \n  const validations = useValidations()\n\n  const videoEl = useRef(null);\n  let intervalDetection = useRef(null);\n  const faceApi = useRef(null)\n  const [ developerMood ] = useState(window?.location?.search?.includes('developer=true'))\n\n  const stageManager = useStage(\n    // create the form stages\n    Object.keys(dataForm?.handleError?.errors || dataForm.stages),\n    dataForm.stages\n  )\n\n  const {\n    stageData,\n    currentStage,\n    stageController,\n    nextStage,\n    finalStage\n  } = stageManager\n\n  \n  const setupFaceApi = async() => {\n    setLoading(true)\n    if(!window.faceapi) return alert('No están cargando las librerías');\n    faceApi.current = window.faceapi\n    await faceApi.current.nets.tinyFaceDetector.loadFromUri(modelsPath)\n    await faceApi.current.nets.faceLandmark68Net.loadFromUri(modelsPath)\n    await faceApi.current.nets.faceRecognitionNet.loadFromUri(modelsPath)\n    await faceApi.current.nets.faceExpressionNet.loadFromUri(modelsPath)\n    startStreaming()\n  } \n\n  const handleVideo = stream => {\n    setCameraAvailable(true)\n    videoEl.current.srcObject = stream;\n  }\n\n  const videoError = err => {\n    console.log('No hay camara conectada o los permisos han sido denegados', err) \n    setCameraAvailable(false)\n  } \n\n\n  const startStreaming = () => {\n    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;\n    if (navigator.getUserMedia) {     \n      navigator.getUserMedia({video: true}, handleVideo, videoError);\n      videoEl.current.addEventListener('play', () => {\n        console.log('el streaming a comenzado', faceApi.current)\n        const canvas = faceApi.current.createCanvasFromMedia(videoEl.current)\n        canvas.style.display = 'none'\n        canvas.id = \"faceApiCanvas\"\n        document.querySelector('#videoContainer').append(canvas)\n        faceApi.current.matchDimensions(canvas, getDisplaySize())\n        setLoading(false)\n      })\n    }\n  }\n\n  const startDeveloperMood = (canvas, detections) => {\n    canvas.style.display = 'initial'\n    const resizedDetections = faceApi.current.resizeResults(detections, getDisplaySize())\n    canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)\n    faceApi.current.draw.drawFaceLandmarks(canvas, resizedDetections)\n    faceApi.current.draw.drawDetections(canvas, resizedDetections)\n    faceApi.current.draw.drawFaceExpressions(canvas, resizedDetections)\n  }\n\n\n  const initDetections = (canvas, intervalTime) => {\n    const scanner = document.querySelector('.FRecScanner')\n    let counter = 1\n    intervalDetection.current = setInterval(async() =>{\n      const detections = await faceApi.current.detectAllFaces(videoEl.current, \n        new faceApi.current.TinyFaceDetectorOptions())\n        .withFaceLandmarks()\n        .withFaceDescriptors()\n        .withFaceExpressions(); \n\n        if(developerMood) startDeveloperMood(canvas, detections);\n        if(detections?.length){\n\n          console.log('validations', stageData?.key)\n          if(scanner && !scanner?.classList?.value?.includes('scanning'))scanner.classList.add('scanning');\n          if(!validations[stageData?.key]){return}\n\n          const [ _value ] = validations[stageData.key](detections[0], {...stageData, state, dataForm});\n          if(!_value || counter > 1){return}\n          canvas.style.display = 'none'\n          setState(prevState => {\n            return { ...prevState, [stageData?.key]: _value ? _value : prevState[stageData?.key] }\n          })\n          clearInterval(intervalDetection.current)\n          setTimeout(()=>nextStage(), 1500)\n          counter++\n        }else{\n          console.log('Detectando...')\n          if(scanner && scanner?.classList?.value.includes('scanning'))scanner.classList.remove('scanning');\n        }\n        \n    }, intervalTime)\n  }\n\n  useEffect(()=>{\n    const canvas = document.querySelector('#faceApiCanvas')\n    const _stageData = dataForm.stages[stageController[currentStage]]\n    if((boardingAgreement && canvas) && (stageData === _stageData && !state[_stageData?.key]) && !finalStage){\n      initDetections(canvas, 600)\n    }\n    return () => clearInterval(intervalDetection.current)\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [stageData, boardingAgreement, loading])\n\n\n  useEffect(()=>{\n    loadDynamicScript(setupFaceApi, `${getCdnPath('faceApi')}`, 'faceApi')\n    return () => {\n      videoEl.current?.pause();\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      videoEl.current?.srcObject?.getTracks()[0].stop()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n\n   if(finalStage){\n    // Render success Stage\n    return (\n      <>\n        { developerMood && <Captures state={state}/> }\n        <DynamicLoadComponent\n              component={dataForm?.successStage?.component}\n              handleDataForm={handleDataForm}\n              handleState={handleState}\n        />\n      </>\n    )\n  }\n\n    return(\n      <Layout>\n        { \n          !boardingAgreement &&\n            <DynamicLoadComponent\n              component=\"onBoardingAgreement\"\n              cameraAvailable={cameraAvailable}\n              handleAction={() => {\n                setBoardingAgreement(true)\n              }}\n            /> \n        }\n\n        { developerMood &&<Captures state={state}/> }\n\n        <ContentContainer id=\"faceApiContainer\">\n          <StatusIndicator \n            data={state[stageData?.key]}\n          />\n          <h3 className=\"FRecTitle fuente\">Reconocimiento Facial</h3>\n          <VideoContainer id=\"videoContainer\">            \n            { loading && <div className=\"biometricLoaderContainer\"></div>}\n            { !developerMood && <Scanner className=\"FRecScanner\"/>}\n            <video id=\"streamingVideo\" autoPlay={true} ref={videoEl} width={'100%'} height={'100%'} />\n          </VideoContainer>\n          <IndicatorStage>\n            <Indicator className={`${currentStage === 0 ? 'active' : ''}`}/>\n            <Indicator className={`${currentStage === 1 ? 'active' : ''}`}/>\n          </IndicatorStage>\n          <h1 className=\"fuente\">{stageData?.uiName}</h1>\n          <p className=\"fuente\">Mantén tu cabeza erguida y asegurate que tu rostro encaje dentro del circulo</p>\n        </ContentContainer>\n      </Layout>\n    )\n} \n\n\nexport default BiometricKycComponent\n\n\nconst Layout = styled.div`\n    display: grid;\n    width: 100vw;\n    height: 100vh;\n    background: #fffffffa;\n    position: absolute;\n    justify-items: center;\n    top: 0;\n    left: 0;\n`\n\n\nconst Indicator = styled.div`\n  width:7px;\n  height:12px;\n  background:#c9c9c9;\n  border-radius:5px;\n  margin:0 4px;\n  transition:.3s;\n  &.active{\n    height:22px;\n    background:#0198ff;\n  }\n`\n\nconst IndicatorStage = styled.div`\n  height:30px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`\n \nconst VideoContainer = styled.div`\n  position: relative;\n  clip-path: circle(37% at 50% 50%);\n`\n\nconst ContentContainer = styled.div`\n\n  position:relative;\n  width:100vw;\n  height:auto;\n  max-width:800px;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: auto 1fr auto auto auto;\n  height: calc(100vh - 80px);\n  padding: 40px 0;\n\n  .FRecTitle{\n    color:#0198ff;\n    font-weight:bold;\n  }\n  p{\n    text-align:center;\n    color:gray;\n    font-size: 1.2em;\n    max-width: 500px;\n    justify-self: center;\n  }\n  h1{\n    text-align:center;\n    font-size: 2.7em;\n    margin-bottom:0;\n  }\n  h3{\n    span{\n      color: transparent;\n      border-radius: 50%;\n      background: #2ad083;\n      margin-right: 10px;\n      font-size:15px;\n    }\n  }\n  @media (max-width: 768px) {\n  ${VideoContainer}{\n    clip-path: circle(29% at 50% 50%);\n  }\n\n  padding: 30px 20px;\n  width:calc(100vw - 40px);\n\n  p{\n    font-size:1em;\n  }\n  h1{\n    font-size:2em;\n  }\n\n}\n`\n\n// Pitch: 'Rotate head' \n// Rigth: +,\n// Left:-\n\n// Roll: 'Tilt head'\n// Rigth: +,\n// Left:-\n\n// Open the mouth\n// Smile\n\n// crear developer mode\n// true = no toma screenshots, muestra indicadores face expressions|detections|logs\n// false = user mood, funcionamiento para usuario final\n\n// Detectar la camara handle camera error | notFound(continous flow from mobile)\n// Agregar marca de agua\n// Copy: Desarrollado por Coinsenda\n\n// Cargar librería de forma dinámica\n// cargar modelos desde cdn \n\n// modularizar en component/utils todas las funciones de utilidad y de validación correspondientes a cada componente\n// diseñar la interfaz\n\n// tener en cuenta el factor tiempo \n// Detectar progresividad de los gestos\n// enviar 3 frames al backend\n\n\n// acceder nativamente a la camara del celular"],"sourceRoot":""}