(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{681:function(t,e){},841:function(t,e,a){"use strict";a.r(e);var s=a(0),r=a.n(s),n=a(7),c=a(1),o=a(2),i=a(12),p=a(14),d=a(18),u=a(16),w=a(17),_=a(5),f=a(63),b=a(34),l=a(64),v=a(657),x=a.n(v),h=a(33),m=a(376),g=a(370),S=h.a.SocketUrl,O=function(t){function e(){var t,a;Object(i.a)(this,e);for(var s=arguments.length,p=new Array(s),w=0;w<s;w++)p[w]=arguments[w];return(a=Object(d.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(p)))).state={currentSwap:null,currentDeposit:null,currentWithdraw:null,isUpdated:!1},a.withdraw_account_mangagement=function(){var t=Object(o.a)(r.a.mark(function t(e){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a.props.withdraw_accounts[e.id]){t.next=2;break}return t.abrupt("return");case 2:"in_progress"!==e.state&&"complete"!==e.state&&"rejected"!==e.state||(a.props.action.update_item_state(Object(n.a)({},e.id,Object(c.a)({},a.props.withdraw_accounts[e.id],e)),"withdraw_accounts"),"complete"===e.state&&(a.props.toastMessage("Nueva cuenta de retiro inscrita","success"),a.props.action.success_sound()));case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),a.withdraw_mangagement=function(){var t=Object(o.a)(r.a.mark(function t(e){var s,o,i,p,d;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.proof){t.next=20;break}if(a.props.withdraws&&(!a.props.withdraws||a.props.withdraws[e.id])){t.next=9;break}return t.next=4,a.props.coinsendaServices.getOrderById(e.id,"withdraws");case 4:return s=t.sent,t.next=7,a.props.coinsendaServices.get_withdraws(s.account_id);case 7:return t.next=9,a.setState({currentWithdraw:s});case 9:if(!a.props.withdraws||!a.props.withdraws[e.id]){t.next=20;break}return t.next=12,a.props.action.update_item_state(Object(n.a)({},e.id,Object(c.a)({},a.props.withdraws[e.id],{proof:e.proof,sent:!0,state:"accepted"})),"withdraws");case 12:return t.next=14,a.props.coinsendaServices.updateActivityState(a.props.withdraws[e.id].account_id,"withdraws");case 14:if(a.props.action.addNotification("wallets",{account_id:a.props.withdraws[e.id].account_id,order_id:e.id},1),a.props.action.success_sound(),a.props.isModalActive||a.props.isRenderModalActive){t.next=20;break}return t.next=19,a.props.action.socket_notify(a.props.withdraws[e.id],"withdraws");case 19:a.props.action.toggleOtherModal();case 20:if("pending"!==e.state||"crypto"!==e.currency_type){t.next=27;break}return t.next=23,a.props.coinsendaServices.addUpdateWithdraw(e.id,"confirmed");case 23:if(t.sent){t.next=27;break}return a.props.action.isAppLoading(!1),t.abrupt("return",a.props.toastMessage("No se ha podido crear la orden de retiro","error"));case 27:if(o=a.state.currentWithdraw,"confirmed"!==e.state||"crypto"!==o.currency_type){t.next=40;break}return i=Object(c.a)({id:o.id,account_id:o.account_id},o,{state:"confirmed"}),t.next=32,a.props.coinsendaServices.addItemToState("withdraws",i);case 32:return t.next=34,a.props.coinsendaServices.updateActivityState(i.account_id,"withdraws");case 34:return t.next=36,a.props.coinsendaServices.manageBalance(i.account_id,"reduce",i.amount);case 36:return t.next=38,a.props.action.isAppLoading(!1);case 38:a.props.action.add_new_transaction_animation(),a.props.history.push("/wallets/activity/".concat(i.account_id,"/withdraws"));case 40:if("accepted"!==e.state||"fiat"!==o.currency_type){t.next=48;break}return p=a.state.currentWithdraw,t.next=44,a.props.coinsendaServices.addItemToState("withdraws",Object(c.a)({},p,{state:"confirmed"}));case 44:return t.next=46,a.props.coinsendaServices.updateActivityState(p.account_id,"withdraws");case 46:a.props.action.add_new_transaction_animation(),a.props.withdraw_accounts[o.withdraw_account_id]&&(d=a.props.withdraw_accounts[o.withdraw_account_id],a.props.action.update_item_state(Object(n.a)({},o.withdraw_account_id,Object(c.a)({},d,{used_counter:++d.used_counter,inscribed:!0})),"withdraw_accounts"));case 48:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),a.deposit_mangagement=function(){var t=Object(o.a)(r.a.mark(function t(e){var s,i,p,d;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("pending"!==e.state||"fiat"!==e.currency_type){t.next=5;break}return t.next=3,a.props.coinsendaServices.addItemToState("deposits",Object(c.a)({},e,{type_order:"deposit"}));case 3:return t.next=5,a.props.coinsendaServices.updateActivityState(e.account_id,"deposits");case 5:if("confirmed"!==e.state){t.next=26;break}if(a.props.deposits&&(!a.props.deposits||a.props.deposits[e.id])){t.next=26;break}return t.next=9,a.props.coinsendaServices.getDepositById(e.id);case 9:if(s=t.sent,!a.props.activity_for_account[s.account_id]||!a.props.activity_for_account[s.account_id].deposits){t.next=17;break}return t.next=13,a.props.coinsendaServices.addItemToState("deposits",Object(c.a)({},s,{type_order:"deposit"}));case 13:return t.next=15,a.props.coinsendaServices.updateActivityState(s.account_id,"deposits");case 15:t.next=19;break;case 17:return t.next=19,a.props.coinsendaServices.get_deposits(s.account_id);case 19:return a.props.action.update_item_state(Object(n.a)({},s.account_id,Object(c.a)({},a.props.wallets[s.account_id],{count:1})),"wallets"),a.props.action.addNotification("wallets",{account_id:s.account_id,order_id:s.id},1),t.next=23,a.props.action.socket_notify(Object(c.a)({},s,{state:"confirmed"}),"deposits","Nuevo deposito detectado");case 23:a.props.action.toggleOtherModal(),a.props.action.success_sound(),setTimeout(function(){a.props.action.add_coin_sound()},1500);case 26:if(!e.confirmations){t.next=39;break}if(a.props.deposits&&(!a.props.deposits||a.props.deposits[e.id])){t.next=33;break}return t.next=30,a.props.coinsendaServices.getOrderById(e.id,"deposits");case 30:return i=t.sent,t.next=33,a.props.coinsendaServices.get_deposits(i.account_id);case 33:if(!a.props.deposits||!a.props.deposits[e.id]){t.next=38;break}return t.next=36,a.props.action.update_item_state(Object(n.a)({},e.id,Object(c.a)({},a.props.deposits[e.id],{confirmations:e.confirmations})),"deposits");case 36:return t.next=38,a.props.coinsendaServices.updateActivityState(a.props.deposits[e.id].account_id,"deposits");case 38:return t.abrupt("return");case 39:if("accepted"!==e.state){t.next=62;break}return t.next=42,a.props.coinsendaServices.getOrderById(e.id,"deposits");case 42:if(p=t.sent,a.props.deposits&&(!a.props.deposits||a.props.deposits[e.id])){t.next=46;break}return t.next=46,a.props.coinsendaServices.get_deposits(p.account_id);case 46:if(!a.props.deposits||!a.props.deposits[e.id]){t.next=62;break}return a.props.action.update_item_state(Object(n.a)({},p.account_id,Object(c.a)({},a.props.wallets[p.account_id],{count:1})),"wallets"),a.props.action.addNotification("wallets",{account_id:a.props.deposits[e.id].account_id,order_id:e.id},1),t.next=51,a.props.action.update_item_state(Object(n.a)({},e.id,Object(c.a)({},a.props.deposits[e.id],{state:e.state})),"deposits");case 51:return t.next=53,a.props.coinsendaServices.updateActivityState(a.props.deposits[e.id].account_id,"deposits");case 53:return t.next=55,a.props.coinsendaServices.getWalletsByUser(!0);case 55:return t.next=57,a.props.action.socket_notify(a.props.deposits[e.id],"deposits");case 57:return t.next=59,a.props.action.renderModal(null);case 59:a.props.action.toggleOtherModal(),a.props.action.success_sound(),setTimeout(function(){a.props.action.add_coin_sound()},1500);case 62:if("rejected"!==e.state&&"canceled"!==e.state){t.next=69;break}if("canceled"!==a.props.deposits[e.id].state){t.next=65;break}return t.abrupt("return",!1);case 65:setTimeout(Object(o.a)(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.props.action.update_item_state(Object(n.a)({},e.id,Object(c.a)({},a.props.deposits[e.id],{state:e.state})),"deposits");case 2:return t.next=4,a.props.coinsendaServices.updateActivityState(a.props.deposits[e.id].account_id,"deposits");case 4:case"end":return t.stop()}},t)})),500),a.props.action.exit_sound(),d="canceled"===e.state?"cancelado":"rechazado",a.props.toastMessage("Deposito ".concat(d),"error");case 69:if("confirmed"!==e.state){t.next=80;break}if(!a.props.deposits||!a.props.deposits[e.id]||"fiat"!==a.props.deposits[e.id].currency_type){t.next=80;break}return t.next=73,a.props.action.update_item_state(Object(n.a)({},e.id,Object(c.a)({},a.props.deposits[e.id],{state:e.state})),"deposits");case 73:return t.next=75,a.props.coinsendaServices.updateActivityState(a.props.deposits[e.id].account_id,"deposits");case 75:return t.next=77,a.props.coinsendaServices.getWalletsByUser(!0);case 77:a.props.action.isAppLoading(!1),a.props.action.success_sound(),a.props.toastMessage("Deposito confirmado con exito","success");case 80:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),a.swap_management=function(){var t=Object(o.a)(r.a.mark(function t(e){var s,i,p;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("pending"!==e.state){t.next=10;break}return s=e,t.next=4,a.props.coinsendaServices.addItemToState("swaps",Object(c.a)({},s,{state:"pending",activeTrade:!0}));case 4:return t.next=6,a.props.coinsendaServices.updateActivityState(s.account_from,"swaps");case 6:return a.props.action.isAppLoading(!1),t.next=9,a.props.history.push("/wallets/activity/".concat(s.account_from,"/swaps"));case 9:a.props.action.add_new_transaction_animation();case 10:if("rejected"!==e.state&&"canceled"!==e.state||setTimeout(Object(o.a)(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.props.action.update_item_state(Object(n.a)({},a.state.currentSwap.id,Object(c.a)({},a.props.swaps[a.state.currentSwap.id],{state:e.state,bought:e.bought,activeTrade:!1})),"swaps"),a.props.coinsendaServices.updateActivityState(a.state.currentSwap.account_from,"swaps"),a.props.action.ticket_rejected(),t.abrupt("return",a.props.toastMessage("El intercambio no se pudo realizar, contacta con soporte","error"));case 4:case"end":return t.stop()}},t)})),2500),"accepted"!==e.state||"done"===a.state.currentSwap.state){t.next=18;break}return i=a.state.currentSwap,t.next=15,a.setState({currentSwap:Object(c.a)({},i,{state:"done"})});case 15:setTimeout(Object(o.a)(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.props.action.success_sound();case 2:a.props.action.update_item_state(Object(n.a)({},i.id,Object(c.a)({},a.props.swaps[i.id],{state:"confirmed",bought:e.bought})),"swaps");case 3:case"end":return t.stop()}},t)})),2500),setTimeout(Object(o.a)(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a.props.action.update_item_state(Object(n.a)({},i.id,Object(c.a)({},a.props.swaps[i.id],{state:"accepted"})),"swaps"),t.next=3,a.props.action.success_sound();case 3:setTimeout(Object(o.a)(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.props.action.update_item_state(Object(n.a)({},i.id,Object(c.a)({},a.props.swaps[i.id],{activeTrade:!1})),"swaps");case 2:return t.next=4,a.props.coinsendaServices.manageBalance(i.account_from,"reduce",i.spent);case 4:return t.next=6,a.props.action.add_coin_sound();case 6:return t.next=8,a.props.toastMessage("Nuevo intercambio realizado","success");case 8:a.props.coinsendaServices.updateActivityState(i.account_from,"swaps");case 9:case"end":return t.stop()}},t)})),2e3);case 4:case"end":return t.stop()}},t)})),5500),a.props.wallets[i.account_to]&&(p=a.props.wallets,a.props.coinsendaServices.updateActivityState(i.account_to,"swaps"),a.props.action.update_item_state(Object(n.a)({},i.account_to,Object(c.a)({},p[i.account_to],{count:1})),"wallets"));case 18:"error"===e.status&&(a.props.toastMessage("El intercambio no se pudo realizar, contacta con soporte","error"),a.props.action.ticket_canceled());case 19:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),a}return Object(w.a)(e,t),Object(p.a)(e,[{key:"componentDidUpdate",value:function(t){var e=this;if((!this.state.isUpdated||this.props.loggedIn!==t.loggedIn)&&(this.setState({isUpdated:!0}),this.props.loggedIn)){var a=x()(S),s=this.props.user,n=function(){!1===a.connected&&a.connect()},c=setInterval(n,2e3);a.on("disconnect",Object(o.a)(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:c=setInterval(n,2e3);case 1:case"end":return t.stop()}},t)}))),a.on("connect",function(){clearInterval(c);var t={body:{access_token:s.userToken}};a.emit("authentication",t),a.on("authenticated",function(){a.on("/swap/".concat(s.id),function(){var t=Object(o.a)(r.a.mark(function t(a){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("pending"!==a.state){t.next=3;break}return t.next=3,e.setState({currentSwap:a});case 3:e.swap_management(a);case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),a.on("/deposit/".concat(s.id),function(){var t=Object(o.a)(r.a.mark(function t(a){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("pending"!==a.state||"crypto"!==a.currency_type){t.next=5;break}return t.next=3,e.setState({currentDeposit:a});case 3:t.next=6;break;case 5:e.deposit_mangagement(a);case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),a.on("/withdraw/".concat(s.id),function(){var t=Object(o.a)(r.a.mark(function t(a){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("pending"!==a.state){t.next=3;break}return t.next=3,e.setState({currentWithdraw:a});case 3:e.withdraw_mangagement(a);case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),a.on("/withdrawAccount/".concat(s.id),function(){var t=Object(o.a)(r.a.mark(function t(a){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("pending"!==a.state){t.next=3;break}return t.next=3,e.setState({currentWithdrawAccount:a});case 3:e.withdraw_account_mangagement(a);case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())})})}}},{key:"render",value:function(){return null}}]),e}(_.Component);e.default=Object(m.h)(Object(f.b)(function(t,e){var a=t.auth.loggedIn,s=t.modelData,r=s.user,n=s.deposits,c=s.withdraws,o=s.wallets,i=s.withdraw_accounts,p=s.swaps,d=t.ui;return{loggedIn:a,user:r,deposits:n,withdraws:c,activity_for_account:t.storage.activity_for_account,wallets:o,swaps:p,withdraw_accounts:i,isModalActive:d.otherModal,isRenderModalActive:d.modal.render}},function(t){return{action:Object(b.bindActionCreators)(l.a,t)}})(Object(g.a)(O)))}}]);
//# sourceMappingURL=49.31ff2453.chunk.js.map